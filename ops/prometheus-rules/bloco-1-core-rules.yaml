groups:
  - name: bloco-1-core-inventory-alerts
    rules:
      # P0: CRÃTICO - Race Conditions (Zero TolerÃ¢ncia)
      - alert: Bloco1RaceConditionDetected
        expr: increase(race_condition_incidents_total[1m]) > 0
        for: 0m
        labels:
          severity: critical
          bloco: "1"
          service: "core-inventory"
          component: "ledger"
        annotations:
          summary: "ðŸš¨ Race Condition Detectada no BLOCO-1 Core Inventory"
          description: "O sistema detectou {{ $value }} tentativas de violaÃ§Ã£o de concorrÃªncia no Ãºltimo minuto. Isso Ã© CRÃTICO e pode causar overselling."
          runbook_url: "https://docs.vertikon.com/runbooks/bloco-1/race-condition"
          dashboard_url: "http://localhost:3000/d/bloco-1-core-inventory-health"

      # P0: CRÃTICO - Overselling Detectado
      - alert: Bloco1OversellingDetected
        expr: increase(overselling_incidents_total[1m]) > 0
        for: 0m
        labels:
          severity: critical
          bloco: "1"
          service: "core-inventory"
          component: "ledger"
        annotations:
          summary: "ðŸš¨ Overselling Detectado no BLOCO-1"
          description: "O sistema detectou {{ $value }} casos de overselling no Ãºltimo minuto. Vendas sem estoque!"
          runbook_url: "https://docs.vertikon.com/runbooks/bloco-1/overselling"
          dashboard_url: "http://localhost:3000/d/bloco-1-core-inventory-health"

      # P0: CRÃTICO - ServiÃ§o IndisponÃ­vel
      - alert: Bloco1ServiceDown
        expr: up{job="mcp-core-inventory"} == 0
        for: 1m
        labels:
          severity: critical
          bloco: "1"
          service: "core-inventory"
          component: "availability"
        annotations:
          summary: "ðŸš¨ ServiÃ§o BLOCO-1 Core Inventory IndisponÃ­vel"
          description: "O serviÃ§o principal do BLOCO-1 estÃ¡ fora do ar hÃ¡ mais de 1 minuto."
          runbook_url: "https://docs.vertikon.com/runbooks/bloco-1/service-down"
          dashboard_url: "http://localhost:3000/d/bloco-1-core-inventory-health"

      # P0: CRÃTICO - Alta Taxa de Erros
      - alert: Bloco1HighErrorRate
        expr: rate(http_requests_total{job="mcp-core-inventory",status=~"5.."}[5m]) > 0.01
        for: 2m
        labels:
          severity: critical
          bloco: "1"
          service: "core-inventory"
          component: "api"
        annotations:
          summary: "ðŸš¨ Alta Taxa de Erros no BLOCO-1"
          description: "Taxa de erros 5xx estÃ¡ acima de 1%: {{ $value | humanizePercentage }}"
          runbook_url: "https://docs.vertikon.com/runbooks/bloco-1/high-error-rate"
          dashboard_url: "http://localhost:3000/d/bloco-1-core-inventory-health"

      # P1: WARNING - Alta LatÃªncia de Reserva
      - alert: Bloco1HighReservationLatency
        expr: histogram_quantile(0.99, sum(rate(http_request_duration_seconds_bucket{handler="ReserveStock"}[5m])) by (le)) > 0.12
        for: 3m
        labels:
          severity: warning
          bloco: "1"
          service: "core-inventory"
          component: "performance"
        annotations:
          summary: "âš ï¸ Alta LatÃªncia de Reserva no BLOCO-1"
          description: "p99 de reserva estÃ¡ acima de 120ms (valor atual: {{ $value }}s)."
          runbook_url: "https://docs.vertikon.com/runbooks/bloco-1/high-latency"
          dashboard_url: "http://localhost:3000/d/bloco-1-core-inventory-health"

      # P1: WARNING - Redis IndisponÃ­vel
      - alert: Bloco1RedisDown
        expr: up{job="redis"} == 0
        for: 30s
        labels:
          severity: warning
          bloco: "1"
          service: "redis"
          component: "cache"
        annotations:
          summary: "âš ï¸ Redis IndisponÃ­vel no BLOCO-1"
          description: "O serviÃ§o Redis estÃ¡ fora do ar hÃ¡ mais de 30 segundos. O sistema pode estar operando em modo degradado."
          runbook_url: "https://docs.vertikon.com/runbooks/bloco-1/redis-down"
          dashboard_url: "http://localhost:3000/d/bloco-1-core-inventory-health"

      # P1: WARNING - Alta LatÃªncia do Redis
      - alert: Bloco1RedisHighLatency
        expr: rate(redis_latency_ms_sum[1m]) / rate(redis_latency_ms_count[1m]) > 50
        for: 2m
        labels:
          severity: warning
          bloco: "1"
          service: "redis"
          component: "cache"
        annotations:
          summary: "âš ï¸ Redis com Alta LatÃªncia no BLOCO-1"
          description: "LatÃªncia mÃ©dia do Redis > 50ms (valor atual: {{ $value }}ms)."
          runbook_url: "https://docs.vertikon.com/runbooks/bloco-1/redis-high-latency"
          dashboard_url: "http://localhost:3000/d/bloco-1-core-inventory-health"

      # P1: WARNING - Postgres Lock Wait
      - alert: Bloco1PostgresLockWait
        expr: postgres_lock_wait_ms > 2000
        for: 1m
        labels:
          severity: warning
          bloco: "1"
          service: "postgres"
          component: "database"
        annotations:
          summary: "âš ï¸ Postgres com Lock Wait Elevado no BLOCO-1"
          description: "Tempo de espera por lock no Postgres > 2s (valor atual: {{ $value }}ms)."
          runbook_url: "https://docs.vertikon.com/runbooks/bloco-1/postgres-lock-wait"
          dashboard_url: "http://localhost:3000/d/bloco-1-core-inventory-health"

      # P1: WARNING - NATS com Atraso
      - alert: Bloco1NatsDelay
        expr: nats_jetstream_lag > 1000
        for: 2m
        labels:
          severity: warning
          bloco: "1"
          service: "nats"
          component: "messaging"
        annotations:
          summary: "âš ï¸ NATS com Atraso no BLOCO-1"
          description: "Lag de mensagens no NATS JetStream > 1000 (valor atual: {{ $value }})."
          runbook_url: "https://docs.vertikon.com/runbooks/bloco-1/nats-delay"
          dashboard_url: "http://localhost:3000/d/bloco-1-core-inventory-health"

      # P2: INFO - Alto Consumo de MemÃ³ria
      - alert: Bloco1HighMemoryUsage
        expr: (container_memory_usage_bytes{name="mcp-core-inventory"} / container_spec_memory_limit_bytes{name="mcp-core-inventory"}) > 0.8
        for: 5m
        labels:
          severity: info
          bloco: "1"
          service: "core-inventory"
          component: "resources"
        annotations:
          summary: "â„¹ï¸ Alto Consumo de MemÃ³ria no BLOCO-1"
          description: "Consumo de memÃ³ria > 80% (valor atual: {{ $value | humanizePercentage }})."
          runbook_url: "https://docs.vertikon.com/runbooks/bloco-1/high-memory-usage"
          dashboard_url: "http://localhost:3000/d/bloco-1-core-inventory-health"

      # P2: INFO - Alto Consumo de CPU
      - alert: Bloco1HighCpuUsage
        expr: rate(container_cpu_usage_seconds_total{name="mcp-core-inventory"}[5m]) > 0.8
        for: 5m
        labels:
          severity: info
          bloco: "1"
          service: "core-inventory"
          component: "resources"
        annotations:
          summary: "â„¹ï¸ Alto Consumo de CPU no BLOCO-1"
          description: "Consumo de CPU > 80% (valor atual: {{ $value | humanizePercentage }})."
          runbook_url: "https://docs.vertikon.com/runbooks/bloco-1/high-cpu-usage"
          dashboard_url: "http://localhost:3000/d/bloco-1-core-inventory-health"

      # P2: INFO - Muitas Reservas Expiradas
      - alert: Bloco1ManyExpiredReservations
        expr: rate(reservations_expired_total[5m]) > 10
        for: 2m
        labels:
          severity: info
          bloco: "1"
          service: "core-inventory"
          component: "business"
        annotations:
          summary: "â„¹ï¸ Muitas Reservas Expiradas no BLOCO-1"
          description: "Taxa de reservas expiradas > 10/min (valor atual: {{ $value }}). Pode indicar problemas no checkout."
          runbook_url: "https://docs.vertikon.com/runbooks/bloco-1/expired-reservations"
          dashboard_url: "http://localhost:3000/d/bloco-1-core-inventory-health"

      # P2: INFO - Baixa Taxa de Sucesso de Reserva
      - alert: Bloco1LowReservationSuccessRate
        expr: rate(http_requests_total{job="mcp-core-inventory",handler="ReserveStock",status="200"}[5m]) / rate(http_requests_total{job="mcp-core-inventory",handler="ReserveStock"}[5m]) < 0.8
        for: 3m
        labels:
          severity: info
          bloco: "1"
          service: "core-inventory"
          component: "business"
        annotations:
          summary: "â„¹ï¸ Baixa Taxa de Sucesso de Reserva no BLOCO-1"
          description: "Taxa de sucesso de reservas < 80% (valor atual: {{ $value | humanizePercentage }})."
          runbook_url: "https://docs.vertikon.com/runbooks/bloco-1/low-reservation-success"
          dashboard_url: "http://localhost:3000/d/bloco-1-core-inventory-health"
